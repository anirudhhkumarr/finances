:root {
  /* -- Colors (Elegant Midnight) -- */
  --bg-primary: #0f172a;
  --bg-secondary: #1e293b;

  --text-primary: #f8fafc;
  --text-secondary: #94a3b8;
  --text-muted: #64748b;

  --accent-color: #38bdf8;
  --accent-glow: rgba(56, 189, 248, 0.15);

  --success-color: #4ade80;
  --danger-color: #f87171;
  --warning-color: #fbbf24;

  --card-bg: #1e293b;
  --card-border: #334155;
  --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);

  /* -- Typography -- */
  --font-heading: 'Outfit', -apple-system, sans-serif;
  --font-body: 'Outfit', -apple-system, sans-serif;
  --font-mono: 'SF Mono', 'Menlo', monospace;

  /* -- Spacing -- */
  --radius-sm: 8px;
  --radius-md: 12px;
}

body {
  background-color: var(--bg-primary);
  color: var(--text-primary);
  font-family: var(--font-body);
  margin: 0;
  padding: 0;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
}

/* -- Minimal Left Sidebar -- */
.app-sidebar-minimal {
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 72px;
  background: var(--bg-secondary);
  border-right: 1px solid var(--card-border);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 24px 0;
  z-index: 1000;
}

.sidebar-logo {
  font-family: var(--font-heading);
  font-weight: 800;
  font-size: 20px;
  color: var(--accent-color);
  margin-bottom: 40px;
}

.sidebar-nav {
  display: flex;
  flex-direction: column;
  gap: 16px;
  width: 100%;
  align-items: center;
}

.nav-btn-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  border: none;
  background: transparent;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 20px;
  transition: all 0.2s ease;
  color: var(--text-secondary);
}

.nav-btn-icon:hover {
  background: rgba(255, 255, 255, 0.05);
  color: var(--text-primary);
}

.nav-btn-icon.active {
  background: var(--accent-color);
  color: #0f172a;
  box-shadow: 0 4px 12px rgba(56, 189, 248, 0.3);
}

.main-content {
  margin-left: 72px;
  padding: 0;
  /* Full bleed for data entry */
  height: 100vh;
  display: flex;
  flex-direction: column;
}

/* -- Balances View -- */
/* -- Balances View -- */
#balances-year-stack {
  padding: 40px;
  max-width: 900px;
  margin: 0 auto;
  font-family: var(--font-body);
}

/* Month Section */
/* Month Section */
.month-section {
  margin-bottom: 0;
  background: transparent;
  /* border-radius: var(--radius-md); Combined radius if stacked? Maybe keep for top/bottom only? */
  /* To make them look like one continuous sheet, remove radius and border between them.
     But simpler first: just remove margin. */
  border-radius: 0;
  overflow: hidden;
  border: 1px solid var(--card-border);
  border-bottom: none;
  /* Merge borders */
}

.month-section:last-child {
  border-bottom: 1px solid var(--card-border);
  border-bottom-left-radius: var(--radius-md);
  border-bottom-right-radius: var(--radius-md);
  margin-bottom: 40px;
  /* Current padding */
}

.month-section:first-child {
  border-top-left-radius: var(--radius-md);
  border-top-right-radius: var(--radius-md);
}

.sticky-month-header {
  position: sticky;
  top: 0;
  z-index: 20;
  background: rgba(15, 23, 42, 0.95);
  backdrop-filter: blur(8px);
  border-bottom: 1px solid var(--card-border);
  padding: 16px 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-family: var(--font-heading);
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.month-stats-brief {
  font-family: var(--font-mono);
  font-size: 14px;
  color: var(--accent-color);
  font-weight: 500;
  background: transparent;
  border: none;
  text-align: right;
  outline: none;
}

.input-override {
  color: var(--accent-color);
  border-bottom: 1px dashed var(--accent-color);
  width: 120px;
}

/* Grid Layout */
.month-grid {
  background: var(--bg-secondary);
}

.balance-row {
  display: grid;
  grid-template-columns: 50px 60px 1fr 1fr 1fr;
  /* Date, Day compact; Amount, Balance, Category equal */
  gap: 16px;
  align-items: center;
  padding: 12px 24px;
  border-bottom: 1px solid var(--card-border);
  font-size: 14px;
  transition: background 0.15s ease;
}

.balance-row:last-child {
  border-bottom: none;
}

.balance-row:hover {
  background: rgba(255, 255, 255, 0.03);
}

/* Header Row */
.balance-row.header {
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: 12px;
  text-transform: uppercase;
  font-weight: 700;
  letter-spacing: 0.5px;
  padding: 12px 24px;
  border-bottom: 2px solid var(--card-border);
}

/* Header cells - consistent font */
.balance-row.header .bal-day,
.balance-row.header .bal-weekday,
.balance-row.header .bal-amt,
.balance-row.header .bal-balance,
.balance-row.header .bal-cat {
  font-size: 11px;
  font-weight: 600;
  font-family: var(--font-body);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-secondary);
}

/* Columns (data rows) */
.bal-day {
  color: var(--text-secondary);
  font-family: var(--font-mono);
  font-weight: 500;
}

.bal-weekday {
  color: var(--text-secondary);
  /* More visible than text-muted */
  font-size: 12px;
  text-transform: uppercase;
  font-weight: 500;
}

/* Input Fields */
.bal-amt,
.bal-cat {
  background: transparent;
  border: 1px solid transparent;
  color: var(--text-primary);
  font-family: var(--font-mono);
  font-size: 14px;
  padding: 6px 10px;
  border-radius: 6px;
  outline: none;
  transition: all 0.2s;
  width: 100%;
}

.bal-amt {
  text-align: right;
  font-weight: 500;
}

.bal-amt:focus,
.bal-cat:focus {
  background: rgba(0, 0, 0, 0.2);
  border-color: var(--accent-color);
  box-shadow: 0 0 0 2px var(--accent-glow);
}

.bal-amt:hover,
.bal-cat:hover {
  background: rgba(255, 255, 255, 0.03);
}

.bal-cat {
  font-family: var(--font-body);
}

/* Balance Column */
.bal-balance {
  text-align: right;
  font-family: var(--font-mono);
  font-weight: 600;
  color: var(--text-secondary);
}

.bal-balance.positive {
  color: var(--text-primary);
}

.bal-balance.negative {
  color: var(--danger-color);
}

/* Recurring / Auto-populated styling */
.balance-row.recurring .bal-cat {
  color: var(--text-muted);
  font-style: italic;
}

.balance-row.recurring:hover .bal-cat {
  color: var(--text-primary);
  font-style: normal;
}

/* --- DATA ENTRY TABLE (Cleaned) --- */
.data-entry-wrapper {
  height: 100vh;
  overflow: auto;
  background: var(--bg-primary);
  /* Dark Theme */
}

.dc-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  min-width: 1000px;
  font-size: 13px;
  font-family: var(--font-body);
  table-layout: fixed;
}

/* Widths */
.dc-table colgroup col.w-month {
  width: 100px;
}

.dc-table colgroup col.w-data {
  width: 100px;
}

/* Headers */
.dc-thead {
  position: sticky;
  top: 0;
  z-index: 20;
  background: var(--bg-primary);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.dc-header-row th {
  background: var(--bg-primary);
  position: sticky;
  top: 0;
  z-index: 20;
  padding: 0;
  border-bottom: 1px solid var(--card-border);
  border-right: 1px solid var(--card-border);
  color: var(--text-primary);
}

/* Group Headers */
.dc-header-row.group th {
  height: 28px;
  text-transform: uppercase;
  font-size: 11px;
  font-weight: 700;
  text-align: center;
  letter-spacing: 0.5px;
  border-bottom: 1px solid var(--card-border);
}

/* Accent Colors for Dark Theme */
.dc-group-th.income {
  background: rgba(74, 222, 128, 0.1);
  color: var(--success-color);
  border-top: 3px solid var(--success-color);
}

.dc-group-th.savings {
  background: rgba(251, 191, 36, 0.1);
  color: var(--warning-color);
  border-top: 3px solid var(--warning-color);
}

.dc-group-th.expenses {
  background: rgba(248, 113, 113, 0.1);
  color: var(--danger-color);
  border-top: 3px solid var(--danger-color);
}

/* Field Headers */
.dc-header-row.field th {
  top: 29px;
  height: 32px;
  font-weight: 600;
  color: var(--text-secondary);
  text-align: right;
  padding: 0 8px;
  background: var(--bg-secondary);
  border-bottom: 2px solid var(--card-border);
  display: table-cell;
  vertical-align: middle;
}

/* Sticky First Column */
.sticky-corner {
  position: sticky;
  left: 0;
  z-index: 30 !important;
  background: var(--bg-primary);
  border-right: 2px solid var(--card-border);
}

.sticky-col-month {
  position: sticky;
  left: 0;
  z-index: 25;
  background: var(--bg-primary);
  border-right: 2px solid var(--card-border);
  text-align: left;
  padding: 0 0 0 12px;
  color: var(--text-primary);
  height: 36px;
  /* Match dc-cell */
  vertical-align: middle;
  box-sizing: border-box;
}

.dc-header-row.field .sticky-col-month {
  text-align: center;
  padding: 0;
  background: var(--bg-secondary);
  height: 32px;
  /* Match header height */
  line-height: 32px;
}

/* Year Row */
.dc-year-row {
  background: var(--card-bg);
  /* Darker row */
  cursor: pointer;
}

.dc-year-row:hover {
  background: rgba(255, 255, 255, 0.05);
}

.dc-year-row td {
  /* Remove global padding so dc-cell works */
  font-weight: 800;
  /* Extra bold */
  font-size: 14px;
  /* Larger */
  color: var(--text-primary);
  border-bottom: 2px solid var(--card-border);
  /* Stronger border */
  text-align: right;
  background: rgba(255, 255, 255, 0.05);
  /* Highlight whole row */
}

.dc-year-row .year-toggle {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;
  background: var(--card-bg);
  border-right: 2px solid var(--card-border);
  padding: 0 0 0 12px;
  /* Internal padding */
  height: 36px;
  /* Explicit height */
}

/* Data Rows */
.dc-data-row:hover td {
  background-color: rgba(255, 255, 255, 0.03);
  /* Subtle highlight */
}

.dc-cell {
  padding: 0;
  height: 36px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.03);
  border-right: 1px solid var(--card-border);
  position: relative;
  background: transparent;
}

.dc-cell-content {
  display: block;
  width: 100%;
  height: 100%;
  padding: 8px;
  text-align: right;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--text-primary);
  font-variant-numeric: tabular-nums;
  box-sizing: border-box;
  /* Fix: Include padding in height */
}

/* Summary Cells (Bold & Big) */
.dc-cell.summary .dc-cell-content {
  font-weight: 800;
  font-size: 14px;
  color: var(--accent-color);
  /* Optional: Make totals pop with accent color? Or keep white. Let's stick to text-primary but bold. */
  color: var(--text-primary);
}

/* Inputs */
.dc-cell.editing input {
  width: 100%;
  height: 100%;
  border: 2px solid var(--accent-color);
  padding: 8px;
  text-align: right;
  font-family: inherit;
  font-size: inherit;
  background: var(--bg-primary);
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
  color: var(--text-primary);
  outline: none;
  margin: 0;
  box-sizing: border-box;
}

.dc-cell.read-only .dc-cell-content {
  color: var(--text-muted);
  background: rgba(0, 0, 0, 0.2);
  /* Darken slightly */
}

.cursor-pointer {
  cursor: pointer;
}

.cursor-pointer:hover {
  opacity: 0.8;
}

/* --- Editable Balance Column --- */
.bal-balance-wrapper {
  text-align: right;
  width: 100%;
}

.bal-balance-input {
  background: transparent;
  border: 1px solid transparent;
  width: 100%;
  text-align: right;
  font-family: var(--font-mono);
  font-weight: 600;
  color: var(--text-secondary);
  font-size: 14px;
  padding: 6px 10px;
  border-radius: 6px;
  outline: none;
  transition: all 0.2s;
  cursor: text;
}

/* Inherit Colors based on wrapper class */
.bal-balance-wrapper.positive .bal-balance-input {
  color: var(--text-primary);
}

.bal-balance-wrapper.negative .bal-balance-input {
  color: var(--danger-color);
}

.bal-balance-input:hover {
  background: rgba(255, 255, 255, 0.03);
}

.bal-balance-input:focus {
  background: rgba(0, 0, 0, 0.2);
  border-color: var(--accent-color);
  /* Ensure readability on focus */
  color: var(--text-primary);
}

/* Visual Indicator for Overrides */
.bal-balance-input.override {
  color: var(--accent-color) !important;
  border-bottom: 1px dashed var(--accent-color);
  background: rgba(56, 189, 248, 0.05);
}

/* Remove Number Input Spinners */
/* Chrome, Safari, Edge, Opera */
input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* Firefox */
input[type=number] {
  -moz-appearance: textfield;
  appearance: textfield;
}

/* Fix Input Sizing and Alignment */
.bal-amt,
.bal-cat,
.bal-balance-input,
.input-override {
  box-sizing: border-box;
  margin: 0;
}

/* Highlight Date if Category exists */
.bal-day.highlight {
  color: var(--accent-color);
  font-weight: 700;
  text-shadow: 0 0 8px var(--accent-glow);
}

/* Global Sticky Header */
.balances-global-header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: rgba(15, 23, 42, 0.95);
  backdrop-filter: blur(8px);
  padding: 16px 24px;
  border-bottom: 1px solid var(--card-border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0;
  /* Visual separator from first month */
}

.global-balance-label {
  font-family: var(--font-heading);
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
}

.global-balance-value {
  font-family: var(--font-mono);
  font-size: 20px;
  font-weight: 700;
  color: var(--accent-color);
  text-shadow: 0 0 10px var(--accent-glow);
}

/* Adjust sticky month header to stick below global header? 
   No, usually stack. Sticky elements stack by default if top is properly managed.
   If global header is 70px h, month header needs top: 70px.
   BUT, we might want month headers to scroll under global header?
   Reference: "month blocks should be contiguous".
   Let's try standard sticky. 
*/
.sticky-month-header {
  top: 61px;
  /* Approx height of global header */
  z-index: 90;
  /* Slightly less than global header */
  box-shadow: none;
  border-bottom: 1px solid var(--card-border);
  background: rgba(30, 41, 59, 0.95);
  /* matching bg-secondary essentially */
}

/* Sticky Layout Stacking */
/* 1. Global Balance Header: Top 0, H ~61px */
/* 2. Global Column Header: Top 61px, H ~48px */
/* 3. Month Header: Top 109px */

.balance-row.header.sticky-columns {
  position: sticky;
  top: 0;
  z-index: 95;
  background: var(--bg-primary);
  border-bottom: 2px solid var(--card-border);
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

/* Adjust Month Header to slide under or stack below? */
.sticky-month-header {
  position: relative;
  /* Changed from sticky to relative/static */
  top: auto;
  z-index: 10;
  /* background: rgba(30, 41, 59, 0.95); Keep bg for visual separation */
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--card-border);
  box-shadow: none;
}

/* --- Row State Highlighting --- */
/* User Set / Active Row */
.balance-row.active {
  background: rgba(30, 41, 59, 0.4);
  /* Slightly distinct from bg-secondary */
  /* border-left: 2px solid var(--accent-color); Optional accent */
}

/* User Set / Active Row Hover */
.balance-row.active:hover {
  background: rgba(30, 41, 59, 0.8);
}


/* Prepopulated / Recurring Row */
.balance-row.recurring {
  background: rgba(74, 222, 128, 0.03);
  /* Very subtle green tint for recurring? Or just distinct grey */
}

.balance-row.recurring:hover {
  background: rgba(74, 222, 128, 0.08);
}

/* Override Input Text Color */
/* Ensure it overrides the positive/negative color inheritance */
.bal-balance-wrapper .bal-balance-input.override {
  color: var(--accent-color) !important;
  font-weight: 700;
  background: rgba(56, 189, 248, 0.1);
  /* Stronger background for visibility */
  border-bottom: 2px solid var(--accent-color);
  /* Stronger indicator */
  border-radius: 4px;
}

/* --- Details: Color Coding Income/Expense/Invest --- */

/* Green for Income (Subtle) */
.balance-row.type-income.active {
  background: rgba(16, 185, 129, 0.15);
  border-left: 3px solid #10b981;
}

.balance-row.type-income.recurring {
  background: rgba(16, 185, 129, 0.08);
}

/* Red for Expense (Subtle) */
.balance-row.type-expense.active {
  background: rgba(239, 68, 68, 0.15);
  border-left: 3px solid #ef4444;
}

.balance-row.type-expense.recurring {
  background: rgba(239, 68, 68, 0.08);
}

/* Yellow for Invest (Subtle) */
.balance-row.type-invest.active {
  background: rgba(234, 179, 8, 0.15);
  border-left: 3px solid #eab308;
}

.balance-row.type-invest.recurring {
  background: rgba(234, 179, 8, 0.08);
}

/* Text Colors for Amount */
.balance-row.type-income .bal-amt {
  color: #22c55e;
  font-weight: 700;
}

.balance-row.type-expense .bal-amt {
  color: #ef4444;
  font-weight: 600;
}

.balance-row.type-invest .bal-amt {
  color: #eab308;
  font-weight: 700;
}

/* Hover effects */
.balance-row.type-income:hover {
  background: rgba(16, 185, 129, 0.5);
}

.balance-row.type-expense:hover {
  background: rgba(239, 68, 68, 0.5);
}

.balance-row.type-invest:hover {
  background: rgba(234, 179, 8, 0.5);
}

/* Sync Button Styles */
.dc-sync-btn {
  background: none;
  border: none;
  cursor: pointer;
  color: #666;
  /* Muted */
  opacity: 0;
  transition: opacity 0.2s ease, color 0.2s ease;
  padding: 0;
  margin-left: 8px;
  display: inline-flex;
  align-items: center;
  vertical-align: middle;
}

.month-label:hover .dc-sync-btn {
  opacity: 0.5;
}

.dc-sync-btn:hover {
  opacity: 1 !important;
  color: #fff;
  /* Brighter on direct hover */
}

/* Make Sync Button Always Visible (Muted) */
.dc-sync-btn {
  opacity: 0.3 !important;
  /* Always visible but faint */
  color: #999;
}

.dc-sync-btn:hover {
  opacity: 1 !important;
  color: #4caf50;
  /* Green on hover */
  transform: scale(1.1);
}

/* Password Dialog */
.pwd-dialog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

.pwd-dialog-content {
  background: #1e1e1e;
  padding: 2rem;
  border-radius: 8px;
  width: 320px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  border: 1px solid #333;
}

.pwd-title {
  margin: 0 0 0.5rem 0;
  color: #fff;
  font-size: 1.25rem;
}

.pwd-desc {
  color: #888;
  margin-bottom: 1.5rem;
  font-size: 0.9rem;
  line-height: 1.4;
}

.pwd-input {
  width: 100%;
  background: #2a2a2a;
  border: 1px solid #444;
  padding: 0.75rem;
  color: #fff;
  border-radius: 4px;
  margin-bottom: 1.5rem;
  font-size: 1rem;
  outline: none;
}

.pwd-input:focus {
  border-color: #4caf50;
}

.pwd-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
}

.pwd-btn {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9rem;
}

.pwd-btn.cancel {
  background: transparent;
  color: #888;
}

.pwd-btn.confirm {
  background: #4caf50;
  color: white;
}

.pwd-btn:hover {
  opacity: 0.9;
}

/* Balances Left Sidebar Layout */
.balances-layout {
  display: flex;
  height: 100vh;
  width: 80%;
  max-width: 1000px;
  min-width: 600px;
  margin: 0 auto;
}

.balances-sidebar {
  width: 100px;
  min-width: 100px;
  background: var(--bg-secondary);
  border-right: 1px solid var(--card-border);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px 10px;
  text-align: center;
}

.sidebar-balance-label {
  font-size: 10px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
  font-weight: 600;
}

.sidebar-balance-value {
  font-family: var(--font-mono);
  font-size: 20px;
  font-weight: 700;
  color: var(--accent-color);
  text-shadow: 0 0 10px var(--accent-glow);
}

/* Adjust main content - fill remaining space */
.balances-layout #balances-year-stack {
  flex: 1;
  overflow-y: auto;
  padding: 0;
}

/* Font Consistency for Balance Headers */
.balance-row.header {
  font-family: var(--font-body);
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.sticky-month-header {
  font-family: var(--font-heading);
  font-size: 14px;
  font-weight: 600;
}

/* Toggle Empty Button */
.toggle-empty-btn {
  background: var(--bg-secondary);
  border: 1px solid var(--card-border);
  color: var(--text-primary);
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.toggle-empty-btn:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: var(--accent-color);
}

/* Negative Amount (Refund) - Green */
.bal-amt.negative-refund {
  color: #4ade80 !important;
}

/* --- Annual Dashboard Styles --- */
.annual-dashboard {
  padding: 32px 40px;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  /* Make consistent with data-entry wrapper scrolling */
  height: 100vh;
  overflow-y: auto;
}

.dash-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  margin-bottom: 32px;
  padding-bottom: 24px;
  border-bottom: 1px solid var(--card-border);
}

.dash-header .title {
  font-size: 32px;
  font-weight: 800;
  margin: 0;
  background: linear-gradient(to right, #38bdf8, #818cf8);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: -1px;
}

.grid-layout {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 24px;
  width: 100%;
}

.chart-card {
  background: var(--bg-secondary);
  border: 1px solid var(--card-border);
  border-radius: var(--radius-md);
  padding: 24px;
  box-shadow: var(--card-shadow);
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: hidden;
}

.chart-card.wide {
  grid-column: span 2;
}

.chart-card.glow {
  box-shadow: 0 0 20px rgba(59, 130, 246, 0.05);
  border-color: rgba(59, 130, 246, 0.2);
}

.card-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.card-head h3 {
  margin: 0;
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
}

.badge {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-secondary);
  background: rgba(255, 255, 255, 0.05);
  padding: 4px 8px;
  border-radius: 4px;
}
/* --- Mobile Responsiveness --- */
@media (max-width: 768px) {

  /* 1. Global Layout & Sidebar */
  .app-sidebar-minimal {
    width: 100%;
    height: 60px;
    top: auto;
    bottom: 0;
    left: 0;
    border-right: none;
    border-top: 1px solid var(--card-border);
    flex-direction: row;
    padding: 0 16px;
    justify-content: space-between;
    box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
    background: rgba(30, 41, 59, 0.95);
    backdrop-filter: blur(10px);
  }

  .sidebar-logo {
    display: none; /* Hide logo on mobile to save space */
  }

  .sidebar-nav {
    flex-direction: row;
    justify-content: space-around; /* Distribute icons evenly */
    height: 100%;
    gap: 0;
    width: 100%;
  }

  .nav-btn-icon {
    width: 100%;
    height: 100%;
    border-radius: 0; /* Full height touch targets */
    max-width: 60px;
  }

  .main-content {
    margin-left: 0;
    margin-bottom: 60px; /* Space for bottom nav */
    height: auto;
    min-height: calc(100vh - 60px);
  }

  /* 2. Summary Dashboard */
  .annual-dashboard {
    padding: 20px 16px; /* Reduce padding */
    height: auto; /* Allow full scroll */
    overflow-y: visible;
  }

  .dash-header {
    flex-direction: column; /* Stack title and slider */
    align-items: flex-start;
    gap: 16px;
  }
  
  .dash-header > div:last-child {
      width: 100% !important; /* Slider full width */
      align-items: flex-start !important;
  }

  .grid-layout {
    grid-template-columns: 1fr; /* Stack charts */
    gap: 16px;
  }

  .chart-card.wide {
    grid-column: auto;
  }

  /* 3. Balances View (Spreadsheet) */
  .balances-layout {
    width: 100%;
    min-width: 0; /* Allow shrinking */
    flex-direction: column;
    height: auto;
  }

  .balances-sidebar {
    display: flex; /* keep distinct from sidebar-nav */
    width: 100%;
    height: auto;
    flex-direction: row;
    overflow-x: auto;
    border-right: none;
    border-bottom: 1px solid var(--card-border);
    padding: 10px;
    gap: 16px;
    justify-content: flex-start;
  }
  
  .balances-sidebar .sidebar-balance-value {
      font-size: 16px;
  }

  #balances-year-stack {
    padding: 16px;
    max-width: 100%;
    flex: none; /* remove flex 1 to allow auto height */
  }

  /* Force horizontal scroll for the grid if needed */
  .month-grid {
      overflow-x: auto;
  }
  
  .balance-row {
      min-width: 500px; /* Ensure row maintains structure and scrolls */
  }
  
  .sticky-month-header {
      top: 0; /* Reset sticky top calc for mobile flow */
  }

  /* 4. Data Entry View */
  .data-entry-wrapper {
      padding-bottom: 60px;
  }
  
  .dc-table {
      min-width: 800px; /* Ensure table scrolls horizontally */
  }
}
