* {
  box-sizing: border-box;
}

:root {
  /* -- Colors (Official Solarized Dark) -- */
  --base03: #002b36;
  --base02: #073642;
  --base01: #586e75;
  --base00: #657b83;
  --base0: #839496;
  --base1: #93a1a1;
  --base2: #eee8d5;
  --base3: #fdf6e3;
  --yellow: #b58900;
  --orange: #cb4b16;
  --red: #dc322f;
  --magenta: #d33682;
  --violet: #6c71c4;
  --blue: #268bd2;
  --cyan: #2aa198;
  --green: #859900;

  --bg-primary: var(--base03);
  --bg-secondary: var(--base02);

  --text-primary: var(--base3);
  --text-secondary: var(--base1);
  --text-muted: var(--base01);

  --accent-color: var(--blue);
  --accent-glow: rgba(38, 139, 210, 0.3);
  /* Blue with opacity for glow */

  --success-color: var(--green);
  --danger-color: var(--red);
  --warning-color: var(--yellow);

  --card-bg: var(--base02);
  --card-border: var(--base01);
  --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  --shadow-color: rgba(0, 0, 0, 0.3);
  --overlay-bg: rgba(0, 43, 54, 0.8);
  /* base03 opacity */

  /* Status Background Tints (Solarized Alpha) */
  /* Cyan (Income) */
  --cyan-bg-subtle: rgba(42, 161, 152, 0.1);
  --cyan-bg-hover: rgba(42, 161, 152, 0.2);
  --cyan-bg-active: rgba(42, 161, 152, 0.3);

  /* Orange (Expense) - DEPRECATED for pure styling, kept for logic if needed */
  /* Magenta (Expense - Preferred) */
  --magenta-bg-subtle: rgba(211, 54, 130, 0.1);
  --magenta-bg-hover: rgba(211, 54, 130, 0.2);
  --magenta-bg-active: rgba(211, 54, 130, 0.3);

  /* Violet (Invest/Savings) */
  --violet-bg-subtle: rgba(108, 113, 196, 0.1);
  --violet-bg-hover: rgba(108, 113, 196, 0.2);
  --violet-bg-active: rgba(108, 113, 196, 0.3);

  /* Deprecated but kept for compatibility just in case */
  --success-bg-subtle: var(--cyan-bg-subtle);
  --success-bg-hover: var(--cyan-bg-hover);
  --success-bg-active: var(--cyan-bg-active);

  --danger-bg-subtle: var(--magenta-bg-subtle);
  --danger-bg-hover: var(--magenta-bg-hover);
  --danger-bg-active: var(--magenta-bg-active);

  --warning-bg-subtle: var(--violet-bg-subtle);
  --warning-bg-hover: var(--violet-bg-hover);
  --warning-bg-active: var(--violet-bg-active);

  /* -- Typography -- */
  --font-heading: 'Outfit', -apple-system, sans-serif;
  --font-body: 'Outfit', -apple-system, sans-serif;
  --font-mono: 'SF Mono', 'Menlo', monospace;

  /* -- Spacing -- */
  --radius-sm: 8px;
  --radius-md: 12px;
}

body {
  background-color: var(--bg-primary);
  color: var(--text-primary);
  font-family: var(--font-body);
  margin: 0;
  padding: 0;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
}

/* -- Minimal Left Sidebar -- */
.app-sidebar-minimal {
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 72px;
  background: var(--bg-secondary);
  border-right: 1px solid var(--card-border);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 24px 0;
  z-index: 1000;
}

.sidebar-logo {
  font-family: var(--font-heading);
  font-weight: 800;
  font-size: 20px;
  color: var(--accent-color);
  margin-bottom: 40px;
}

.sidebar-actions-top {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-bottom: 32px;
}

.sidebar-nav {
  display: flex;
  flex-direction: column;
  gap: 16px;
  width: 100%;
  align-items: center;
}

.nav-btn-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  border: none;
  background: transparent;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 20px;
  transition: all 0.2s ease;
  color: var(--text-secondary);
}

.nav-btn-icon:hover {
  background: var(--base03);
  color: var(--text-primary);
}

.nav-btn-icon.active {
  background: var(--accent-color);
  color: var(--bg-primary);
  box-shadow: 0 4px 12px var(--accent-glow);
}

.main-content {
  margin-left: 72px;
  padding: 0;
  /* Full bleed for data entry */
  height: 100vh;
  display: flex;
  flex-direction: column;
}

/* -- Balances View -- */
/* -- Balances View -- */
#balances-year-stack {
  padding: 40px;
  max-width: 900px;
  margin: 0 auto;
  font-family: var(--font-body);
}

/* Month Section */
/* Month Section */
.month-section {
  margin-bottom: 0;
  background: transparent;
  /* border-radius: var(--radius-md); Combined radius if stacked? Maybe keep for top/bottom only? */
  /* To make them look like one continuous sheet, remove radius and border between them.
     But simpler first: just remove margin. */
  border-radius: 0;
  overflow: hidden;
  border: 1px solid var(--card-border);
  border-bottom: none;
  /* Merge borders */
}

.month-section:last-child {
  border-bottom: 1px solid var(--card-border);
  border-bottom-left-radius: var(--radius-md);
  border-bottom-right-radius: var(--radius-md);
  margin-bottom: 40px;
  /* Current padding */
}

.month-section:first-child {
  border-top-left-radius: var(--radius-md);
  border-top-right-radius: var(--radius-md);
}

.sticky-month-header {
  position: sticky;
  top: 0;
  z-index: 20;
  background: var(--bg-primary);
  border-bottom: 1px solid var(--card-border);
  padding: 16px 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-family: var(--font-heading);
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
  box-shadow: 0 4px 6px -1px var(--bg-primary);
}

.month-stats-brief {
  font-family: var(--font-mono);
  font-size: 14px;
  color: var(--accent-color);
  font-weight: 500;
  background: transparent;
  border: none;
  text-align: right;
  outline: none;
}

.input-override {
  color: var(--accent-color);
  border-bottom: 1px dashed var(--accent-color);
  width: 120px;
}

/* Grid Layout */
.month-grid {
  background: var(--bg-secondary);
}

.balance-row {
  display: grid;
  grid-template-columns: 50px 60px 1fr 1fr 1fr;
  /* Date, Day compact; Amount, Balance, Category equal */
  gap: 16px;
  align-items: center;
  padding: 12px 24px;
  border-bottom: 1px solid var(--card-border);
  font-size: 14px;
  transition: background 0.15s ease;
}

.balance-row:last-child {
  border-bottom: none;
}

.balance-row:hover {
  background: var(--bg-secondary);
}

/* Header Row */
.balance-row.header {
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: 12px;
  text-transform: uppercase;
  font-weight: 700;
  letter-spacing: 0.5px;
  padding: 12px 24px;
  border-bottom: 2px solid var(--card-border);
}

/* Header cells - consistent font */
.balance-row.header .bal-day,
.balance-row.header .bal-weekday,
.balance-row.header .bal-amt,
.balance-row.header .bal-balance,
.balance-row.header .bal-cat {
  font-size: 11px;
  font-weight: 600;
  font-family: var(--font-body);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-secondary);
}

/* Columns (data rows) */
.bal-day {
  color: var(--text-secondary);
  font-family: var(--font-mono);
  font-weight: 500;
}

.bal-weekday {
  color: var(--text-secondary);
  /* More visible than text-muted */
  font-size: 12px;
  text-transform: uppercase;
  font-weight: 500;
}

/* Input Fields */
.bal-amt,
.bal-cat {
  background: transparent;
  border: 1px solid transparent;
  color: var(--text-primary);
  font-family: var(--font-mono);
  font-size: 14px;
  padding: 6px 10px;
  border-radius: 6px;
  outline: none;
  transition: all 0.2s;
  width: 100%;
}

.bal-amt {
  text-align: right;
  font-weight: 500;
}

.bal-amt:focus,
.bal-cat:focus {
  background: rgba(0, 0, 0, 0.2);
  border-color: var(--accent-color);
  box-shadow: 0 0 0 2px var(--accent-glow);
}

.bal-amt:hover,
.bal-cat:hover {
  background: var(--bg-secondary);
}

.bal-cat {
  font-family: var(--font-body);
}

/* Hide datalist dropdown arrow */
.bal-cat::-webkit-calendar-picker-indicator {
  display: none !important;
}

.bal-cat::-webkit-list-button {
  display: none !important;
}

/* Balance Column */
.bal-balance {
  text-align: right;
  font-family: var(--font-mono);
  font-weight: 600;
  color: var(--text-secondary);
}

.bal-balance.positive {
  color: var(--text-primary);
}

.bal-balance.negative {
  color: var(--danger-color);
}

/* Recurring / Auto-populated styling */
.balance-row.recurring .bal-cat {
  color: var(--text-muted);
  font-style: italic;
}

.balance-row.recurring:hover .bal-cat {
  color: var(--text-primary);
  font-style: normal;
}

/* --- DATA ENTRY TABLE (Cleaned) --- */
.data-entry-wrapper {
  height: 100vh;
  overflow: auto;
  background: var(--bg-primary);
  /* Dark Theme */
}

.dc-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  min-width: 1000px;
  font-size: 13px;
  font-family: var(--font-body);
  table-layout: fixed;
}

/* Widths */
.dc-table colgroup col.w-month {
  width: 100px;
}

.dc-table colgroup col.w-data {
  width: 100px;
}

/* Headers */
.dc-thead {
  z-index: 140;
  background: var(--bg-primary);
  box-shadow: 0 1px 2px var(--bg-primary);
}

.dc-header-row th {
  position: -webkit-sticky;
  position: sticky;
  top: 0;
  z-index: 140;
  background: var(--bg-primary);
  border-bottom: 1px solid var(--card-border);
  border-right: 1px solid var(--card-border);
  color: var(--text-primary);
}

/* Group Headers */
.dc-header-row.group th {
  height: 28px;
  text-transform: uppercase;
  font-size: 11px;
  font-weight: 700;
  text-align: center;
  letter-spacing: 0.5px;
  border-bottom: 1px solid var(--card-border);
}

/* Accent Colors for Dark Theme */
.dc-group-th.income {
  background: var(--bg-secondary);
  color: var(--success-color);
  border-top: 3px solid var(--success-color);
}

.dc-group-th.savings {
  background: var(--bg-secondary);
  color: var(--warning-color);
  border-top: 3px solid var(--warning-color);
}

.dc-group-th.expenses {
  background: var(--bg-secondary);
  color: var(--danger-color);
  border-top: 3px solid var(--danger-color);
}

/* Field Headers */
.dc-header-row.field th {
  top: 28px;
  /* Height of group header */
  height: 32px;
  font-weight: 600;
  color: var(--text-secondary);
  text-align: right;
  padding: 0 8px;
  background: var(--bg-secondary);
  border-bottom: 2px solid var(--card-border);
  vertical-align: middle;
}

/* Sticky First Column */
.sticky-corner {
  position: -webkit-sticky;
  position: sticky;
  left: 0;
  top: 0 !important;
  z-index: 150 !important;
  background: var(--bg-primary) !important;
  border-right: 2px solid var(--card-border);
}

.sticky-col-month {
  position: -webkit-sticky;
  position: sticky;
  left: 0;
  z-index: 50;
  background: var(--bg-primary);
  border-right: 2px solid var(--card-border);
  text-align: left;
  padding: 0 0 0 12px;
  color: var(--text-primary);
  height: 36px;
  /* Match dc-cell */
  vertical-align: middle;
  box-sizing: border-box;
}

.dc-header-row.field .sticky-col-month {
  top: 28px !important;
  z-index: 145;
  text-align: center;
  padding: 0;
  background: var(--bg-secondary) !important;
  height: 32px;
  line-height: 32px;
}

/* Year Row */
.dc-year-row {
  background: var(--card-bg);
  /* Darker row */
  cursor: pointer;
}

.dc-year-row:hover {
  background: var(--bg-secondary);
}

.dc-year-row td {
  position: -webkit-sticky;
  position: sticky;
  top: 60px;
  /* Below field header (28+32) */
  z-index: 60;
  font-weight: 800;
  font-size: 14px;
  color: var(--text-primary);
  border-bottom: 2px solid var(--card-border);
  text-align: right;
  background: var(--card-bg);
  /* Use solid color for sticky row */
}

/* Ensure sticky month column inside year row has correct z-index and top */
.dc-year-row td.sticky-col-month {
  z-index: 70;
  top: 60px !important;
}

.dc-year-row .year-toggle .dc-sticky-content {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;
  background: inherit;
  height: 36px;
}

.dc-year-row .year-toggle {
  background: var(--card-bg);
  border-right: 2px solid var(--card-border);
  padding: 0 0 0 12px;
  height: 36px;
}

/* Data Rows */
.dc-data-row:hover td {
  background-color: var(--bg-secondary);
  /* Subtle highlight */
}

.dc-cell {
  padding: 0;
  height: 36px;
  border-bottom: 1px solid var(--card-border);
  border-right: 1px solid var(--card-border);
  position: relative;
  background: transparent;
}

.dc-cell-content {
  display: block;
  width: 100%;
  height: 100%;
  padding: 8px;
  text-align: right;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--text-primary);
  font-variant-numeric: tabular-nums;
  box-sizing: border-box;
  /* Fix: Include padding in height */
}

/* Summary Cells (Bold & Big) */
.dc-cell.summary .dc-cell-content {
  font-weight: 800;
  font-size: 14px;
  color: var(--accent-color);
  /* Optional: Make totals pop with accent color? Or keep white. Let's stick to text-primary but bold. */
  color: var(--text-primary);
}

/* Inputs */
.dc-cell.editing input {
  width: 100%;
  height: 100%;
  border: 2px solid var(--accent-color);
  padding: 8px;
  text-align: right;
  font-family: inherit;
  font-size: inherit;
  background: var(--bg-primary);
  box-shadow: 0 4px 6px -1px var(--shadow-color);
  color: var(--text-primary);
  outline: none;
  margin: 0;
  box-sizing: border-box;
}

.dc-cell.read-only .dc-cell-content {
  color: var(--text-muted);
  background: rgba(0, 0, 0, 0.2);
  /* Darken slightly */
}

.cursor-pointer {
  cursor: pointer;
}

.cursor-pointer:hover {
  opacity: 0.8;
}

/* --- Editable Balance Column --- */
.bal-balance-wrapper {
  text-align: right;
  width: 100%;
}

.bal-balance-input {
  background: transparent;
  border: 1px solid transparent;
  width: 100%;
  text-align: right;
  font-family: var(--font-mono);
  font-weight: 600;
  color: var(--text-secondary);
  font-size: 14px;
  padding: 6px 10px;
  border-radius: 6px;
  outline: none;
  transition: all 0.2s;
  cursor: text;
}

/* Inherit Colors based on wrapper class */
.bal-balance-wrapper.positive .bal-balance-input {
  color: var(--text-primary);
}

.bal-balance-wrapper.negative .bal-balance-input {
  color: var(--danger-color);
}

.bal-balance-input:hover {
  background: rgba(253, 246, 227, 0.03);
}

.bal-balance-input:focus {
  background: rgba(0, 0, 0, 0.2);
  border-color: var(--accent-color);
  /* Ensure readability on focus */
  color: var(--text-primary);
}

/* Visual Indicator for Overrides */
.bal-balance-input.override {
  color: var(--cyan) !important;
  border-bottom: 1px dashed var(--cyan);
  background: var(--bg-primary);
}

/* Remove Number Input Spinners */
/* Chrome, Safari, Edge, Opera */
input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* Firefox */
input[type=number] {
  -moz-appearance: textfield;
  appearance: textfield;
}

/* Fix Input Sizing and Alignment */
.bal-amt,
.bal-cat,
.bal-balance-input,
.input-override {
  box-sizing: border-box;
  margin: 0;
}

/* Highlight Date if Category exists */
.bal-day.highlight {
  color: var(--cyan);
  /* Cyan fits Solarized better for subtle highlights */
  font-weight: 700;
}

/* Global Sticky Header */
.balances-global-header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--bg-primary);
  border-bottom: 1px solid var(--card-border);
  padding: 16px 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0;
  /* Visual separator from first month */
}

.global-balance-label {
  font-family: var(--font-heading);
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
}

.global-balance-value {
  font-family: var(--font-mono);
  font-size: 20px;
  font-weight: 700;
  color: var(--accent-color);
  text-shadow: 0 0 10px var(--accent-glow);
}

/* Adjust sticky month header to stick below global header? 
   No, usually stack. Sticky elements stack by default if top is properly managed.
   If global header is 70px h, month header needs top: 70px.
   BUT, we might want month headers to scroll under global header?
   Reference: "month blocks should be contiguous".
   Let's try standard sticky. 
*/
.sticky-month-header {
  top: 61px;
  /* Approx height of global header */
  z-index: 90;
  /* Slightly less than global header */
  box-shadow: none;
  border-bottom: 1px solid var(--card-border);
  background: var(--bg-secondary);
  /* matching bg-secondary essentially */
}

/* Sticky Layout Stacking */
/* 1. Global Balance Header: Top 0, H ~61px */
/* 2. Global Column Header: Top 61px, H ~48px */
/* 3. Month Header: Top 109px */

.balance-row.header.sticky-columns {
  position: sticky;
  top: 0;
  z-index: 95;
  background: var(--bg-primary);
  border-bottom: 2px solid var(--card-border);
  box-shadow: 0 4px 6px -1px var(--shadow-color);
}

/* Adjust Month Header to slide under or stack below? */
.sticky-month-header {
  position: relative;
  /* Changed from sticky to relative/static */
  top: auto;
  z-index: 10;
  /* background: rgba(30, 41, 59, 0.95); Keep bg for visual separation */
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--card-border);
  box-shadow: none;
}

/* --- Row State Highlighting --- */
/* User Set / Active Row */
.balance-row.active {
  background: var(--bg-secondary);
  /* Slightly distinct from bg-secondary */
  /* border-left: 2px solid var(--accent-color); Optional accent */
}

/* User Set / Active Row Hover */
.balance-row.active:hover {
  background: var(--bg-primary);
}


/* Prepopulated / Recurring Row */
.balance-row.recurring {
  background: var(--success-bg-subtle);
  /* Very subtle green tint for recurring? Or just distinct grey */
}

.balance-row.recurring:hover {
  background: var(--success-bg-hover);
}

/* Override Input Text Color */
/* Ensure it overrides the positive/negative color inheritance */
.bal-balance-wrapper .bal-balance-input.override {
  color: var(--cyan) !important;
  font-weight: 700;
  background: var(--bg-primary);
  /* Stronger background for visibility */
  border-bottom: 2px solid var(--cyan);
  /* Stronger indicator */
  border-radius: 4px;
}

/* --- Details: Color Coding Income/Expense/Invest --- */

/* Green (now Cyan) for Income (Subtle) */
.balance-row.type-income.active {
  background: var(--cyan-bg-active);
  /* Solarized Cyan tint */
  border-left: 3px solid var(--cyan);
}

.balance-row.type-income.recurring {
  background: var(--cyan-bg-subtle);
}

/* Magenta (Expense) */
.balance-row.type-expense.active {
  background: var(--magenta-bg-active);
  /* Solarized Magenta tint */
  border-left: 3px solid var(--magenta);
}

.balance-row.type-expense.recurring {
  background: var(--magenta-bg-subtle);
}

/* Yellow (now Violet) for Invest (Subtle) */
.balance-row.type-invest.active {
  background: var(--violet-bg-active);
  /* Solarized Violet tint */
  border-left: 3px solid var(--violet);
}

.balance-row.type-invest.recurring {
  background: var(--violet-bg-subtle);
}

/* Text Colors for Amount */
.balance-row.type-income .bal-amt {
  color: var(--cyan);
  font-weight: 700;
}

.balance-row.type-expense .bal-amt {
  color: var(--magenta);
  font-weight: 600;
}

.balance-row.type-invest .bal-amt {
  color: var(--violet);
  font-weight: 700;
}

/* Hover effects */
.balance-row.type-income:hover {
  background: var(--cyan-bg-hover);
  /* Solarized Cyan */
}

.balance-row.type-expense:hover {
  background: var(--magenta-bg-hover);
  /* Solarized Magenta */
}

.balance-row.type-invest:hover {
  background: var(--violet-bg-hover);
  /* Solarized Violet */
}

/* Sync Button Styles */
.dc-sync-btn {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text-muted);
  /* Muted */
  opacity: 0;
  transition: opacity 0.2s ease, color 0.2s ease;
  padding: 0;
  margin-left: 8px;
  display: inline-flex;
  align-items: center;
  vertical-align: middle;
}

.month-label:hover .dc-sync-btn {
  opacity: 0.5;
}

.dc-sync-btn:hover {
  opacity: 1 !important;
  color: var(--text-primary);
  /* Brighter on direct hover */
}

/* Make Sync Button Always Visible (Muted) */
.dc-sync-btn {
  opacity: 0.3 !important;
  color: var(--text-muted);
}

.dc-sync-btn:hover {
  opacity: 1 !important;
  color: var(--success-color);
  transform: scale(1.1);
}

/* Password Dialog */
.pwd-dialog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--overlay-bg);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

.pwd-dialog-content {
  background: var(--card-bg);
  padding: 24px;
  border-radius: var(--radius-md);
  width: 90%;
  max-width: 400px;
  box-shadow: var(--card-shadow);
  border: 1px solid var(--card-border);
}

.pwd-title {
  margin: 0 0 0.5rem 0;
  color: var(--text-primary);
  font-size: 1.25rem;
}

.pwd-desc {
  color: var(--text-secondary);
  margin-bottom: 1.5rem;
  font-size: 0.9rem;
  line-height: 1.4;
}

.pwd-input {
  width: 100%;
  background: var(--bg-primary);
  border: 1px solid var(--card-border);
  padding: 0.75rem;
  color: var(--text-primary);
  border-radius: 4px;
  margin-bottom: 1.5rem;
  font-size: 1rem;
  outline: none;
}

.pwd-input:focus {
  border-color: var(--accent-color);
}

.pwd-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
}

.pwd-btn {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9rem;
}

.pwd-btn.cancel {
  background: transparent;
  color: var(--text-secondary);
}

.pwd-btn.confirm {
  background: var(--accent-color);
  color: var(--bg-primary);
}

.pwd-btn:hover {
  opacity: 0.9;
}

/* Balances Left Sidebar Layout */
.balances-layout {
  display: flex;
  height: 100vh;
  width: 80%;
  max-width: 1000px;
  min-width: 600px;
  margin: 0 auto;
}

.balances-sidebar {
  width: 100px;
  min-width: 100px;
  background: var(--bg-secondary);
  border-right: 1px solid var(--card-border);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px 10px;
  text-align: center;
}

.sidebar-summary {
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--card-border);
  padding: 24px;
}

.sidebar-summary-item {
  margin-bottom: 16px;
}

.sidebar-balance-label {
  font-size: 12px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 4px;
}

.sidebar-balance-value {
  font-family: var(--font-mono);
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
}

.sidebar-balance-value.positive {
  color: var(--success-color);
}

.sidebar-balance-value.negative {
  color: var(--danger-color);
}

/* Adjust main content - fill remaining space */
.balances-layout #balances-year-stack {
  flex: 1;
  overflow-y: auto;
  padding: 0;
}

/* Font Consistency for Balance Headers */
.balance-row.header {
  font-family: var(--font-body);
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.sticky-month-header {
  font-family: var(--font-heading);
  font-size: 14px;
  font-weight: 600;
}

/* Toggle Empty Button */
.toggle-empty-btn {
  background: var(--bg-secondary);
  border: 1px solid var(--card-border);
  color: var(--text-primary);
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.toggle-empty-btn:hover {
  background: var(--bg-secondary);
}

/* Negative Amount (Refund) - Green */
.bal-amt.negative-refund {
  color: var(--success-color) !important;
}

/* --- Annual Dashboard Styles --- */
.annual-dashboard {
  padding: 32px 40px;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  /* Make consistent with data-entry wrapper scrolling */
  height: 100vh;
  overflow-y: auto;
}

.dash-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  margin-bottom: 32px;
  padding-bottom: 24px;
  border-bottom: 1px solid var(--card-border);
}

.dash-header .title {
  font-size: 32px;
  font-weight: 800;
  margin: 0;
  background: linear-gradient(to right, var(--accent-color), #2aa198);
  /* Solarized blue to cyan */
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: -1px;
}

.grid-layout {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 24px;
  width: 100%;
}

.chart-card {
  background: var(--bg-secondary);
  border: 1px solid var(--card-border);
  border-radius: var(--radius-md);
  padding: 24px;
  box-shadow: var(--card-shadow);
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: hidden;
}

.chart-card.wide {
  grid-column: span 2;
}

.chart-card.glow {
  box-shadow: 0 0 20px var(--bg-primary);
  border-color: var(--base01);
}

.card-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.card-head h3 {
  margin: 0;
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
}

.badge {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-secondary);
  background: var(--bg-primary);
  padding: 16px 24px;
  border-radius: 4px;
}

/* --- Mobile Responsiveness --- */
@media (max-width: 1100px) {

  /* Prevent horizontal overflow on body */
  body,
  html {
    overflow-x: hidden;
  }

  /* 1. Global Layout & Sidebar -> Bottom Nav */
  .app-sidebar-minimal {
    position: fixed;
    width: 100%;
    height: calc(60px + env(safe-area-inset-bottom, 0px));
    top: auto;
    bottom: 0;
    left: 0;
    border-right: none;
    border-top: 1px solid var(--card-border);
    flex-direction: row;
    padding: 0;
    padding-bottom: env(safe-area-inset-bottom, 0px);
    justify-content: space-evenly;
    align-items: center;
    box-shadow: 0 -4px 6px -1px var(--bg-primary);
    background: var(--bg-primary);
    /* Solid background, no transparency */
    z-index: 1000;
  }

  .sidebar-logo {
    display: none;
  }

  .sidebar-nav {
    display: contents;
    /* Let nav buttons flow into parent's flex layout */
  }

  .nav-btn-icon {
    width: 50px;
    height: 60px;
    border-radius: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    flex: 0 0 auto;
  }

  /* Keep export/import in bottom nav on mobile */
  .sidebar-actions-top {
    display: contents !important;
    /* Let action buttons flow into parent's flex layout */
  }

  .main-content {
    margin-left: 0;
    padding: 0 16px;
    /* Increased side margins */
    padding-bottom: calc(70px + env(safe-area-inset-bottom, 0px));
    height: auto;
    min-height: 100vh;
    overflow-x: hidden;
    box-sizing: border-box;
  }

  /* 2. Summary Dashboard */
  .annual-dashboard {
    padding: 16px 0;
    /* No horizontal padding here, use main-content */
    height: auto;
    overflow-x: hidden;
    max-width: 100vw;
    box-sizing: border-box;
  }

  .dash-header {
    flex-direction: column;
    align-items: stretch;
    gap: 12px;
  }

  .dash-header .title {
    font-size: 24px;
  }

  .dash-header>div:last-child {
    width: 100% !important;
    align-items: flex-start !important;
  }

  .grid-layout {
    grid-template-columns: 1fr;
    gap: 16px;
  }

  .chart-card.wide {
    grid-column: auto;
  }

  .chart-card {
    padding: 16px;
  }

  .card-head {
    flex-wrap: wrap;
    gap: 8px;
  }

  .card-head h3 {
    font-size: 16px;
  }

  /* 3. Balances View */
  .balances-layout {
    width: 100%;
    max-width: 100vw;
    min-width: 0;
    flex-direction: column;
    height: auto;
    overflow-x: hidden;
  }

  .balances-sidebar {
    display: none;
  }

  #balances-year-stack {
    padding: 12px;
    max-width: 100%;
    width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
  }

  .month-section {
    max-width: 100%;
    /* Remove overflow-x to allow vertical sticky headers in Safari */
  }

  .month-section {
    border-radius: 0;
  }

  .sticky-month-header {
    position: -webkit-sticky;
    position: sticky;
    top: 0;
    z-index: 50;
    padding: 12px 16px;
    font-size: 14px;
    background: var(--bg-primary) !important;
  }

  /* Allow horizontal scroll for data rows */
  .month-grid {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .balance-row {
    display: flex;
    min-width: unset;
    width: 100%;
    box-sizing: border-box;
    gap: 8px;
    padding: 12px 16px;
    border-bottom: 1px solid var(--card-border);
    align-items: center;
  }

  .balance-row.header {
    background: var(--bg-primary);
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .balance-row input {
    font-size: 16px;
    padding: 6px;
    box-sizing: border-box;
  }

  .bal-day {
    width: 20px;
    flex: 0 0 auto;
    color: var(--text-secondary);
  }

  .bal-weekday {
    width: 30px;
    flex: 0 0 auto;
    color: var(--text-secondary);
    font-size: 11px;
  }

  /* Compact header labels to prevent overlap */
  .balance-row.header .bal-day {
    font-size: 0;
  }

  .balance-row.header .bal-day::after {
    content: '#';
    font-size: 11px;
  }

  .balance-row.header .bal-weekday {
    font-size: 0;
  }

  .balance-row.header .bal-weekday::after {
    content: 'D';
    font-size: 11px;
  }

  .bal-amt {
    width: 75px;
    flex: 0 0 auto;
  }

  .bal-balance-wrapper {
    width: 85px;
    flex: 0 0 auto;
  }

  .bal-cat {
    flex: 1;
    min-width: 80px;
  }

  .bal-cat {
    min-width: 0;
  }

  /* Toggle button fix */
  .toggle-empty-btn {
    padding: 4px 8px;
  }

  .data-entry-wrapper {
    height: 100vh;
    height: 100dvh;
    overflow: auto;
    padding-bottom: 80px;
    width: 100%;
    -webkit-overflow-scrolling: touch;
  }

  .dc-table {
    min-width: 100%;
    table-layout: fixed;
    width: auto;
  }

  .dc-table col:first-child,
  .dc-table col.w-month {
    width: 20vw !important;
  }

  .dc-table col:not(:first-child),
  .dc-table col.collapsed-col {
    width: calc(80vw / 3) !important;
  }

  .dc-table th.dc-th,
  .dc-table td.dc-cell,
  .dc-table th.dc-group-th {
    width: calc(80vw / 3) !important;
    min-width: calc(80vw / 3) !important;
    box-sizing: border-box;
    /* Local reset for table cells */
  }

  .dc-table th.sticky-corner {
    position: -webkit-sticky;
    position: sticky;
    width: 20vw !important;
    min-width: 20vw !important;
    left: 0;
    top: 0 !important;
    z-index: 150 !important;
    background: var(--bg-primary);
    box-sizing: border-box;
  }

  .dc-table th.sticky-col-month {
    position: -webkit-sticky;
    position: sticky;
    width: 20vw !important;
    min-width: 20vw !important;
    left: 0;
    top: 28px !important;
    /* Below group header */
    z-index: 145 !important;
    background: var(--bg-secondary) !important;
    box-sizing: border-box;
  }

  .dc-table td.sticky-col-month {
    position: -webkit-sticky;
    position: sticky;
    width: 20vw !important;
    min-width: 20vw !important;
    left: 0;
    z-index: 50;
    background: var(--bg-primary);
    box-sizing: border-box;
  }

  .dc-year-row td {
    position: -webkit-sticky;
    position: sticky;
    top: 60px !important;
    z-index: 60 !important;
  }

  .dc-year-row td.sticky-col-month {
    z-index: 70 !important;
  }

  /* Password Dialog */
  .pwd-dialog-content {
    width: 90%;
    max-width: 320px;
  }
}